generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id         Int       @id @default(autoincrement())
  userId     Int       @default(autoincrement())
  provider   String
  providerId String
  updatedAt  DateTime? @db.Timestamp(6)
  createdAt  DateTime  @db.Timestamp(6)
  User       User      @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([providerId])
  @@index([provider])
  @@index([userId])
}

model Authority {
  id            Int             @id @default(autoincrement())
  name          String          @unique
  description   String
  updatedAt     DateTime?       @db.Timestamp(6)
  createdAt     DateTime        @db.Timestamp(6)
  UserAuthority UserAuthority[]

  @@index([name])
}

model Category {
  id             Int            @id @default(autoincrement())
  name           String         @unique
  parentId       Int            @default(autoincrement())
  updatedAt      DateTime?      @db.Timestamp(6)
  createdAt      DateTime       @db.Timestamp(6)
  Category       Category       @relation("CategoryToCategory", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  other_Category Category[]     @relation("CategoryToCategory")
  PostCategory   PostCategory[]

  @@index([name])
  @@index([parentId])
}

model FavoritePost {
  userId    Int      @default(autoincrement())
  postId    Int      @default(autoincrement())
  createdAt DateTime @db.Timestamp(6)
  Post      Post     @relation(fields: [postId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  User      User     @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([userId, postId])
  @@index([postId])
  @@index([userId])
}

model Package {
  id           Int       @id @default(autoincrement())
  postId       Int       @default(autoincrement())
  title        String
  description  String?
  revision     Int?      @default(0)
  deliveryTime DateTime  @db.Time(6)
  price        Decimal   @db.Money
  special      Json?     @db.Json
  updatedAt    DateTime? @db.Timestamp(6)
  createdAt    DateTime  @db.Timestamp(6)
  Post         Post      @relation(fields: [postId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([postId, title])
}

model Post {
  id                  Int                   @id @default(autoincrement())
  userId              Int                   @default(autoincrement())
  title               String
  content             String
  stars               BigInt?               @default(0)
  favorties           BigInt?               @default(0)
  about               String
  starCount           BigInt?               @default(0)
  updatedAt           DateTime?             @db.Timestamp(6)
  createdAt           DateTime              @db.Timestamp(6)
  FavoritePost        FavoritePost[]
  Order               Order[]
  Package             Package[]
  User                User                  @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  PostBrowsingHistory PostBrowsingHistory[]
  PostCategory        PostCategory[]
  PostImage           PostImage[]
  PostTag             PostTag[]
  Preview             Preview[]
}

model PostCategory {
  postId     Int      @default(autoincrement())
  categoryId Int      @default(autoincrement())
  createdAt  DateTime @db.Timestamp(6)
  Category   Category @relation(fields: [categoryId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Post       Post     @relation(fields: [postId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([postId, categoryId])
  @@index([categoryId])
  @@index([postId])
}

model PostImage {
  id        Int      @id @default(autoincrement())
  postId    Int      @default(autoincrement())
  link      String
  createdAt DateTime @db.Timestamp(6)
  Post      Post     @relation(fields: [postId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([postId])
}

model PostTag {
  tagId     Int      @default(autoincrement())
  postId    Int      @default(autoincrement())
  createdAt DateTime @db.Timestamp(6)
  Post      Post     @relation(fields: [postId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Tag       Tag      @relation(fields: [tagId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([tagId, postId])
  @@index([postId])
  @@index([tagId])
}

model Preview {
  userId    Int      @default(autoincrement())
  postId    Int      @default(autoincrement())
  star      Int
  comment   String
  createdAt DateTime @db.Timestamp(6)
  Post      Post     @relation(fields: [postId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  User      User     @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([userId, postId])
  @@index([postId])
  @@index([userId])
}

model Role {
  id          Int        @id @default(autoincrement())
  name        String     @unique
  description String
  updatedAt   DateTime?  @db.Timestamp(6)
  createdAt   DateTime   @db.Timestamp(6)
  UserRole    UserRole[]

  @@index([name])
}

model Tag {
  id          Int       @id @default(autoincrement())
  name        String
  description String
  updatedAt   DateTime? @db.Timestamp(6)
  createdAt   DateTime  @db.Timestamp(6)
  PostTag     PostTag[]

  @@index([name])
}

model User {
  id            Int             @id @default(autoincrement())
  username      String
  about         String
  updatedAt     DateTime?       @db.Timestamp(6)
  createdAt     DateTime        @db.Timestamp(6)
  avatar        String?
  Account       Account[]
  FavoritePost  FavoritePost[]
  Post          Post[]
  Preview       Preview[]
  UserAuthority UserAuthority[]
  UserRole      UserRole[]
}

model UserAuthority {
  userId      Int       @default(autoincrement())
  authorityId Int       @default(autoincrement())
  createdAt   DateTime  @db.Timestamp(6)
  Authority   Authority @relation(fields: [authorityId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  User        User      @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([userId, authorityId])
  @@index([authorityId])
  @@index([userId])
}

model UserRole {
  userId    Int      @default(autoincrement())
  roleId    Int      @default(autoincrement())
  createdAt DateTime @db.Timestamp(6)
  Role      Role     @relation(fields: [roleId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  User      User     @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([userId, roleId])
  @@index([roleId])
  @@index([userId])
}

model Order {
  id           Int          @id @default(autoincrement())
  postId       Int          @default(autoincrement())
  title        String
  description  String?
  revision     Int?         @default(0)
  deliveryTime DateTime     @db.Time(6)
  price        Decimal      @db.Money
  special      Json?        @db.Json
  status       OrderStatus? @default(Pending)
  createdAt    DateTime     @db.Timestamp(6)
  Post         Post         @relation(fields: [postId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([postId])
  @@index([status])
}

model PostBrowsingHistory {
  id        Int      @id @default(autoincrement())
  postId    Int      @default(autoincrement())
  createdAt DateTime @db.Timestamp(6)
  Post      Post     @relation(fields: [postId], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model Skill {
  id            Int           @id @default(autoincrement())
  categoryId    Int           @default(autoincrement())
  name          String
  description   String
  updatedAt     DateTime?     @db.Timestamp(6)
  createdAt     DateTime      @db.Timestamp(6)
  SkillCategory SkillCategory @relation(fields: [categoryId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([categoryId])
  @@index([name])
}

model SkillCategory {
  id          Int       @id @default(autoincrement())
  name        String
  description String
  updatedAt   DateTime? @db.Timestamp(6)
  createdAt   DateTime  @db.Timestamp(6)
  Skill       Skill[]

  @@index([name])
}

enum OrderStatus {
  Pending
  Accepted
  Rejected
}
